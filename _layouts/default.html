<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>{{ page.title }}</title>
    <link rel="stylesheet" href="https://use.typekit.net/znu8lis.css">

    <link rel="stylesheet" href="{{ "/assets/tailwind.css" | relative_url }}">
    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.5.1/dist/algoliasearch-lite.umd.js"></script>
    <script src="//unpkg.com/alpinejs" defer></script>

    <link rel="shortcut icon" href="/assets/images/favico/favicon.ico">
    <link rel="icon" sizes="16x16 32x32 64x64" href="/assets/images/favico/favicon.ico">
    <link rel="icon" type="image/png" sizes="196x196" href="/assets/images/favico/favicon-192.png">
    <link rel="icon" type="image/png" sizes="160x160" href="/assets/images/favico/favicon-160.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/images/favico/favicon-96.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/assets/images/favico/favicon-64.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favico/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favico/favicon-16.png">
    <link rel="apple-touch-icon" href="/assets/images/favico/favicon-57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/favico/favicon-114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/favico/favicon-72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favico/favicon-144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/images/favico/favicon-60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/favico/favicon-120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/favico/favicon-76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/favico/favicon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favico/favicon-180.png">
  </head>
  <body class="bg-black h-screen" x-init="">
    <section class="w-full flex flex-row items-stretch h-full">
      <main class="text-white w-full md:w-[550px]">
        {{ content }}
      </main>

      <nav class="border flex-grow hidden md:block" id="container">
        <div class="flex flex-col justify-center w-full h-full">
          <div class="w-[800px] h-[800px] border border-red-200 relative flex-none" id="rotate">
            {% for num in (1..6) %}
            <div class="absolute rounded-full w-52 border h-52 text-white flex flex-col justify-center items-center text-center menu-{{num}}" :style="{'transform': 'rotate('+$store.nav.angle+'deg)'}">
              Section: {{num}}
            </div>
            {% endfor %}
          </div>
        </div>

      </nav>
    </section>    

    <script>
      document.addEventListener('alpine:init', function(){
        Alpine.store('nav', {
          component: 1, 
          angle: 0
        })
      })
    </script>

    <script>
      (function() {
        var init, rotate, start, stop,
          active = false,
          angle = 0,
          rotation = 0,
          startAngle = 0,
          center = {
            x: 0,
            y: 0
          },
          R2D = 180 / Math.PI,
          rot = document.getElementById('rotate');

        init = function() {
          rot.addEventListener("mousedown", start, false);
          document.addEventListener('mousemove', function(event){
            if (active === true) {
              event.preventDefault();
              rotate(event);
            }            
          })

          document.addEventListener('mouseup', function(event){
            event.preventDefault();            
            stop(event);            
          })

        };

        start = function(e) {
          rot.classList.remove('transition-transform');
          e.preventDefault();
          var bb = this.getBoundingClientRect(),
            t = bb.top,
            l = bb.left,
            h = bb.height,
            w = bb.width,
            x, y;
          center = {
            x: l + (w / 2),
            y: t + (h / 2)
          };
          x = e.clientX - center.x;
          y = e.clientY - center.y;
          startAngle = R2D * Math.atan2(y, x);
          return active = true;
        };

        rotate = function(e) {
          e.preventDefault();
          var x = e.clientX - center.x,
            y = e.clientY - center.y,
            d = R2D * Math.atan2(y, x);
          rotation = d - startAngle;
          Alpine.store('nav').angle = -(angle + rotation)
          return rot.style.webkitTransform = "rotate(" + (angle + rotation) + "deg)";
        };

        stop = function() {
          angle += rotation;
          defineSection(angle)
          Alpine.store('nav').angle = -angle
          return active = false;
        };

        closestEquivalentAngle = function(from, to) {
            var delta = ((((to - from) % 360) + 540) % 360) - 180;
            return from + delta;
        }

        defineSection = function(baseAngle){
          let _angle = ((baseAngle) % 360)
          rot.classList.add('transition-transform');
          let target = 0
          let component = null
          if(_angle < 0){
            _angle = Math.abs(_angle)
            if((_angle >= 0 && _angle <= 30) || (_angle >= 330 && _angle <= 360)){
              target = 0
              component = 1
            }else if((_angle >= 30 && _angle <= 90)){
              target = -60
              component = 2
            }else if(_angle >= 90 && _angle <= 150){
              target = -120
              component = 3
            }else if(_angle >= 150 && _angle <= 210){
              target = -180
              component = 4
            }else if(_angle >= 210 && _angle <= 270){
              target = -240
              component = 5
            }else if(_angle >= 270 && _angle <= 330){
              target = -300
              component = 6
            }
          }else{
            if((_angle >= 0 && _angle <= 30) || (_angle >= 330 && _angle <= 360)){
              target = 0
              component = 1
            }else if((_angle >= 30 && _angle <= 90)){
              target = 60
              component = 6
            }else if(_angle >= 90 && _angle <= 150){
              target = 120
              component = 5
            }else if(_angle >= 150 && _angle <= 210){
              target = 180
              component = 4
            }else if(_angle >= 210 && _angle <= 270){
              target = 240
              component = 3
            }else if(_angle >= 270 && _angle <= 330){
              target = 300
              component = 2
            }
          }
          if(component){
            Alpine.store('nav').component = component            
          }
          let d = closestEquivalentAngle(baseAngle, target)        
          rot.style.webkitTransform = "rotate(" + (d) + "deg)";
          angle = d
          Alpine.store('nav').angle = -angle
        }

        init();
      }).call(this);

    </script>

  </body>
</html>